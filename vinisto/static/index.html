<html>
    <head>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
        <script src="https://unpkg.com/vue@2.2.6"></script>
        <script src="https://cdn.jsdelivr.net/vue.resource/1.2.1/vue-resource.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-throttle-debounce/1.1/jquery.ba-throttle-debounce.min.js"></script>
        <style> textarea{ width: 100%; border: 0px!important; border-bottom:1px solid lightgrey!important; height:auto; overflow-y:hidden; } </style>
        <link rel="stylesheet" href="https://bootswatch.com/sandstone/bootstrap.min.css" />
    </head>
    <body>
        <div class=container>
             <div id="features">
                <h2>Configuration</h2>
                <form class="form" onsubmit="return false;">
                <button class="btn btn-large" v-on:click="add_feature">Add sentence</button>
                </form>

                <textarea class="form-control" v-on:keyUp="update_feature"
                          v-model="item.text"
                          v-model.lazy="item.text"
                          v-bind:data-uri="item.$uri"
                          v-for="item in features">{{ item.text }}</textarea>
             </div>
        </div>

        <script>
            window.data = {"features": []};

            new Vue({el: "#features", data: window.data,
                created: function(){
                    this.update_features();
                },
                methods: {
                    add_feature: function(){
                        Vue.http.post('/feature', {'text': "# New feature"}).then(
                            response => {
                                this.update_features();
                            });
                    },
                    update_feature: function(ev){
                        Vue.http.patch(ev.target.dataset.uri, {"text": ev.target.value});
                    },
                    update_features: function(){
                        Vue.http.get('/feature').then(
                            response => {
                                window.setTimeout(this.resize_textareas, 400);
                                window.data["features"] = response.body;
                            });
                    },
                    resize_textareas: function(){ $("textarea").each(function(a, e){$(e).height(e.scrollHeight);});}
                }
            });
        </script>
    </body>
</html>
